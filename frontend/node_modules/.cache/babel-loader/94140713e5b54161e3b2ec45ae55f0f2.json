{"ast":null,"code":"var _jsxFileName = \"/Users/taiki/Desktop/household/frontend/src/components/Spending/Spending.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from 'react';\nimport { Link, useParams, useHistory } from 'react-router-dom';\nimport { AuthContext } from '../../App'; // calendar\n\nimport format from 'date-fns/format'; // component\n\nimport Calendar from './Calendar/Calendar';\nimport SpendingList from './SpendingList/SpendingList'; // api\n\nimport { getHousehold, deleteHousehold } from '../../api/household';\nimport { getAllSpending } from '../../api/spending';\nimport { getSpendingTotal } from '../../api/spending'; // function\n\nimport { useWindowDimensions } from '../../function/window';\nimport { getCalendarArray } from '../../function/calendar'; // css\n\nimport style from './Spending.module.scss'; // interface\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Spending = () => {\n  _s();\n\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const history = useHistory();\n  const urlParams = useParams();\n  const [targetDate, setTargetDate] = useState(new Date());\n  const [spendings, setSpendings] = useState([]);\n  const [currentTotalAmount, setCurrentTotalAmount] = useState(0);\n  const [amountPlanned, setAmountPlanned] = useState(0);\n  const [household, setHousehold] = useState(); // 利用予定額と利用額との差額\n\n  const balance = amountPlanned - currentTotalAmount; // カレンダーの月日情報\n\n  const calendar = getCalendarArray(targetDate); // ブラウザのwidth情報取得\n\n  const width = useWindowDimensions(); // 利用履歴一覧の取得処理\n\n  const handleGetSpendings = async () => {\n    if (!currentUser) return;\n\n    try {\n      const res = await getAllSpending(currentUser === null || currentUser === void 0 ? void 0 : currentUser.id, Number(urlParams.householdId));\n      if ((res === null || res === void 0 ? void 0 : res.status) !== 200) return;\n      setSpendings(res.data);\n    } catch (err) {\n      console.log('利用履歴一覧取得エラー', err);\n    }\n  }; // 利用月別合計金額の合計\n\n\n  const handleGetSpendingsTotal = async () => {\n    if (!currentUser) return;\n    const params = {\n      targetDate: targetDate\n    };\n\n    try {\n      const res = await getSpendingTotal(currentUser.id, Number(urlParams.householdId), params);\n      setCurrentTotalAmount(res === null || res === void 0 ? void 0 : res.data);\n    } catch (err) {\n      console.log('利用金額合計', err);\n    }\n\n    ;\n  }; // 家計簿の詳細取得\n\n\n  const handleGetHousehold = async () => {\n    if (!currentUser) return;\n\n    try {\n      const res = await getHousehold(currentUser.id, Number(urlParams.householdId));\n      setHousehold(res === null || res === void 0 ? void 0 : res.data);\n      setAmountPlanned(res === null || res === void 0 ? void 0 : res.data.amountPlanned);\n    } catch (err) {\n      console.log(err);\n    }\n  }; // 家計簿の削除処理\n\n\n  const handleDeleteHousehold = async e => {\n    e.preventDefault();\n    const sure = window.confirm('削除してよろしいですか?');\n    if (!sure) return;\n\n    try {\n      if (!currentUser) return; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n      const res = await deleteHousehold(currentUser.id, Number(urlParams.householdId));\n      history.push('/');\n    } catch (err) {\n      console.log(err);\n      alert('削除ができませんでした');\n    }\n\n    ;\n  };\n\n  useEffect(() => {\n    handleGetHousehold();\n    handleGetSpendings(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [setSpendings]);\n  useEffect(() => {\n    handleGetSpendingsTotal(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [targetDate]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: style.spendings,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: style.householdName,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: `/${Number(urlParams.householdId)}/edithousehold`,\n          children: household === null || household === void 0 ? void 0 : household.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this), width < 1100 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"\\u5229\\u7528\\u4E88\\u5B9A:\", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: style.amountPlanned,\n          children: [\"\\xA5\", household === null || household === void 0 ? void 0 : household.amountPlanned]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 13\n      }, this) : '']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: style.monthbox,\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: style.month,\n        children: [format(targetDate, 'M月'), \":\", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: balance >= 0 ? style.balanceBlue : style.balanceRed,\n          children: [\"\\xA5\", balance]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this), width > 1100 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"\\u5229\\u7528\\u4E88\\u5B9A: \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: style.amount_planned,\n          children: household === null || household === void 0 ? void 0 : household.amountPlanned\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 13\n      }, this) : '', /*#__PURE__*/_jsxDEV(\"p\", {\n        className: style.totalamount,\n        children: [\"\\u5229\\u7528\\u5408\\u8A08: \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: style.totalnumber,\n          children: [\"-\", currentTotalAmount]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: style.householdMain,\n      children: [/*#__PURE__*/_jsxDEV(Calendar, {\n        targetDate: targetDate,\n        setTargetDate: setTargetDate,\n        calendar: calendar,\n        spendings: spendings,\n        urlParams: urlParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this), width < 1100 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: style.button,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: style.amountSave,\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: `/${urlParams.householdId}/spendings/addspending`,\n            children: \"\\u4F7F\\u3063\\u305F\\u91D1\\u984D\\u3092\\u8A18\\u9332\\u3059\\u308B\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: style.householdDelete,\n          onClick: handleDeleteHousehold,\n          children: \"\\u5BB6\\u8A08\\u7C3F\\u3092\\u524A\\u9664\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }, this) : '', /*#__PURE__*/_jsxDEV(SpendingList, {\n        targetDate: targetDate,\n        calendar: calendar,\n        spendings: spendings,\n        urlParams: urlParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), width >= 1100 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: style.buttonPc,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: style.amountSave,\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: `/${urlParams.householdId}/spendings/addspending`,\n          children: \"\\u4F7F\\u3063\\u305F\\u91D1\\u984D\\u3092\\u8A18\\u9332\\u3059\\u308B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: style.householdDelete,\n        onClick: handleDeleteHousehold,\n        children: \"\\u5BB6\\u8A08\\u7C3F\\u3092\\u524A\\u9664\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 9\n    }, this) : '']\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Spending, \"YiYt++DbpUHefh/2CymRRHazmDo=\", false, function () {\n  return [useHistory, useParams, useWindowDimensions];\n});\n\n_c = Spending;\nexport default Spending;\n\nvar _c;\n\n$RefreshReg$(_c, \"Spending\");","map":{"version":3,"sources":["/Users/taiki/Desktop/household/frontend/src/components/Spending/Spending.tsx"],"names":["React","useState","useEffect","useContext","Link","useParams","useHistory","AuthContext","format","Calendar","SpendingList","getHousehold","deleteHousehold","getAllSpending","getSpendingTotal","useWindowDimensions","getCalendarArray","style","Spending","currentUser","history","urlParams","targetDate","setTargetDate","Date","spendings","setSpendings","currentTotalAmount","setCurrentTotalAmount","amountPlanned","setAmountPlanned","household","setHousehold","balance","calendar","width","handleGetSpendings","res","id","Number","householdId","status","data","err","console","log","handleGetSpendingsTotal","params","handleGetHousehold","handleDeleteHousehold","e","preventDefault","sure","window","confirm","push","alert","householdName","name","monthbox","month","balanceBlue","balanceRed","amount_planned","totalamount","totalnumber","householdMain","button","amountSave","householdDelete","buttonPc"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport { Link, useParams, useHistory } from 'react-router-dom';\nimport { AuthContext } from '../../App';\n// calendar\nimport format from 'date-fns/format';\n// component\nimport Calendar from './Calendar/Calendar';\nimport SpendingList from './SpendingList/SpendingList';\n// api\nimport { getHousehold, deleteHousehold } from '../../api/household';\nimport { getAllSpending } from '../../api/spending';\nimport { getSpendingTotal } from '../../api/spending';\n// function\nimport { useWindowDimensions } from '../../function/window';\nimport { getCalendarArray } from '../../function/calendar';\n// css\nimport style from './Spending.module.scss';\n// interface\nimport { GetHousehold } from '../../interface';\n\nconst Spending: React.FC = () => {\n  const { currentUser } = useContext(AuthContext);\n  const history = useHistory();\n  const urlParams = useParams<{householdId: string}>();\n  const [targetDate, setTargetDate] = useState(new Date());\n  const [spendings, setSpendings] = useState([]);\n  const [currentTotalAmount, setCurrentTotalAmount] = useState(0);\n  const [amountPlanned, setAmountPlanned] = useState(0);\n  const [household, setHousehold] = useState<GetHousehold>();\n  // 利用予定額と利用額との差額\n  const balance = amountPlanned - currentTotalAmount;\n  // カレンダーの月日情報\n  const calendar  = getCalendarArray(targetDate);\n  // ブラウザのwidth情報取得\n  const width = useWindowDimensions();\n  // 利用履歴一覧の取得処理\n  const handleGetSpendings = async () => {\n    if(!currentUser) return\n    try {\n      const res = await getAllSpending(currentUser?.id, Number(urlParams.householdId));\n      if (res?.status !== 200) return;\n      setSpendings(res.data);\n    } catch (err: any) {\n      console.log('利用履歴一覧取得エラー', err);\n    }\n  };\n\n  // 利用月別合計金額の合計\n  const handleGetSpendingsTotal = async () => {\n    if (!currentUser) return;\n    const params = { targetDate: targetDate };\n    try {\n      const res = await getSpendingTotal(currentUser.id, Number(urlParams.householdId), params);\n      setCurrentTotalAmount(res?.data);\n    } catch (err: any) {\n      console.log('利用金額合計', err);\n    };\n  };\n  // 家計簿の詳細取得\n  const handleGetHousehold = async () => {\n    if (!currentUser) return;\n    try {\n      const res = await getHousehold(currentUser.id, Number(urlParams.householdId));\n      setHousehold(res?.data);\n      setAmountPlanned(res?.data.amountPlanned);\n    } catch (err: any) {\n      console.log(err);\n    }\n  };\n  // 家計簿の削除処理\n  const handleDeleteHousehold = async (e: React.MouseEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    const sure = window.confirm('削除してよろしいですか?');\n    if(!sure) return;\n    try {\n      if(!currentUser) return;\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const res = await deleteHousehold(currentUser.id, Number(urlParams.householdId));\n      history.push('/');\n    } catch (err: any) {\n      console.log(err);\n      alert('削除ができませんでした')\n    };\n  };\n  useEffect(() => {\n    handleGetHousehold();\n    handleGetSpendings();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [setSpendings]);\n  useEffect(() => {\n    handleGetSpendingsTotal();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [targetDate]);\n\n   return (\n    <div className={style.spendings}>\n      <div className={style.householdName}>\n        <h2>\n          <Link to={`/${Number(urlParams.householdId)}/edithousehold`}>{household?.name}</Link>\n        </h2>\n        {width < 1100 ? (\n            <p>\n              利用予定:\n              <span className={style.amountPlanned}>¥{household?.amountPlanned}</span>\n            </p>\n          ) : '' }\n      </div>\n      <div className={style.monthbox}>\n        <h3 className={style.month}>\n          {format(targetDate, 'M月')}:\n          <span className={balance >= 0 ? style.balanceBlue : style.balanceRed }>\n            ¥{balance}\n          </span>\n        </h3>\n        {width > 1100 ? (\n            <p>\n              利用予定: <span className={style.amount_planned}>{household?.amountPlanned}</span>\n            </p>\n          ) : '' }\n        <p className={style.totalamount}>\n          利用合計: <span className={style.totalnumber}>-{currentTotalAmount}</span>\n        </p>\n      </div>\n      <div className={style.householdMain}>\n        <Calendar\n          targetDate={targetDate}\n          setTargetDate={setTargetDate}\n          calendar={calendar}\n          spendings={spendings}\n          urlParams={urlParams}\n        />\n        { width < 1100 ? (\n          <div className={style.button}>\n            <div className={style.amountSave}>\n              <Link to={`/${urlParams.householdId}/spendings/addspending`}>\n                使った金額を記録する\n              </Link>\n            </div>\n            <div className={style.householdDelete} onClick={handleDeleteHousehold}>\n              家計簿を削除\n            </div>\n          </div>\n        ) : '' }\n        <SpendingList\n          targetDate={targetDate}\n          calendar={calendar}\n          spendings={spendings}\n          urlParams={urlParams}\n        />\n      </div>\n      {width >= 1100 ? (\n        <div className={style.buttonPc}>\n          <div className={style.amountSave}>\n            <Link to={`/${urlParams.householdId}/spendings/addspending`}>使った金額を記録する</Link>\n          </div>\n          <div className={style.householdDelete} onClick={handleDeleteHousehold}>\n            家計簿を削除\n          </div>\n        </div>\n      ) : '' }\n    </div>\n  )\n}\n\nexport default Spending"]},"metadata":{},"sourceType":"module"}