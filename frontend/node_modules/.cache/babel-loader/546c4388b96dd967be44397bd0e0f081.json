{"ast":null,"code":"import _asyncToGenerator from\"/Users/taiki/Desktop/household/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/taiki/Desktop/household/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/taiki/Desktop/household/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useContext,useState,useEffect}from'react';import{AuthContext}from'../../App';import{Link}from'react-router-dom';// calendar\nimport format from'date-fns/format';import addMonths from'date-fns/addMonths';import subMonths from'date-fns/subMonths';//component\n// function\nimport{useWindowDimensions}from'../../function/window';// api\nimport{getAllHousehold,getMonthSpendingTotal}from'../../api/household';// css\nimport style from'./HouseHold.module.scss';// interface\n// image\nimport HouseholdBook from'../../image/householdBook.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";;var HouseHold=function HouseHold(){var initialHousehold={id:1,name:\"\",amountPlanned:1,userId:0,createdAt:new Date(),updatedAt:new Date()};var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useState=useState([initialHousehold]),_useState2=_slicedToArray(_useState,2),households=_useState2[0],setHouseholds=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),spendings=_useState4[0],setSpendings=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),allSpendingTotal=_useState6[0],setAllSpendingTotal=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),allAmountPlanned=_useState8[0],setAllAmountPlanned=_useState8[1];var _useState9=useState(new Date()),_useState10=_slicedToArray(_useState9,2),targetDate=_useState10[0],setTargetDate=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),openPcHouseholdModal=_useState12[0],setOpenPcHouseholdModal=_useState12[1];var balance=allAmountPlanned-allSpendingTotal;var width=useWindowDimensions();var handleChangePcModal=function handleChangePcModal(){setOpenPcHouseholdModal(true);};// 家計簿一覧の取得\nvar handleGetAllHousehold=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(currentUser){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;_context.next=5;return getAllHousehold(currentUser.id);case 5:res=_context.sent;if((res===null||res===void 0?void 0:res.status)===200){setHouseholds(res.data);};_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);console.log(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[2,10]]);}));return function handleGetAllHousehold(){return _ref.apply(this,arguments);};}();// 全家計簿の月別利用合計の取得\nvar handleGetAllSpendingTotal=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params={targetDate:targetDate};if(currentUser){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:_context2.prev=3;_context2.next=6;return getMonthSpendingTotal(currentUser.id,params);case 6:res=_context2.sent;setAllSpendingTotal(res===null||res===void 0?void 0:res.data.total);setAllAmountPlanned(res===null||res===void 0?void 0:res.data.allAmountPlanned);setSpendings(res===null||res===void 0?void 0:res.data.allSpending);_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](3);console.log('月別全合計',_context2.t0);case 15:;case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[3,12]]);}));return function handleGetAllSpendingTotal(){return _ref2.apply(this,arguments);};}();useEffect(function(){handleGetAllHousehold();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){handleGetAllSpendingTotal();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[targetDate]);return/*#__PURE__*/_jsxs(\"div\",{className:style.household,children:[/*#__PURE__*/_jsx(\"h2\",{children:currentUser===null||currentUser===void 0?void 0:currentUser.name}),/*#__PURE__*/_jsxs(\"div\",{className:style.month,children:[/*#__PURE__*/_jsxs(\"h3\",{children:[format(targetDate,'M月'),\":  \",/*#__PURE__*/_jsxs(\"span\",{className:balance>=0?style.balance_amount_blue:style.balance_amount_red,children:[\"\\xA5\",balance]})]}),/*#__PURE__*/_jsxs(\"h4\",{className:style.amount_total,children:[\"\\u5229\\u7528\\u984D: \",/*#__PURE__*/_jsxs(\"span\",{children:[\"-\",allSpendingTotal]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:style.monthMove,children:[/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return setTargetDate(function(current){return subMonths(current,1);});},children:\"\\u2039 \\u524D\\u306E\\u6708\"}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return setTargetDate(new Date());},children:\"\\u4ECA\\u6708\"}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return setTargetDate(function(current){return addMonths(current,1);});},children:\"\\u6B21\\u306E\\u6708 \\u203A\"})]}),/*#__PURE__*/_jsx(\"div\",{className:style.householdMap,children:households&&households.map(function(household){return/*#__PURE__*/_jsxs(\"div\",{className:style.householdBook,children:[/*#__PURE__*/_jsx(\"div\",{className:style.householdName,children:household.name}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Link,{to:\"/\".concat(household.id,\"/spendings\"),children:/*#__PURE__*/_jsx(\"img\",{src:HouseholdBook,alt:\"household book\"})})}),/*#__PURE__*/_jsxs(\"p\",{className:style.amount,children:[\"\\xA5\",spendings&&// eslint-disable-next-line array-callback-return\nspendings.filter(function(spending){if(household.id===spending.householdId)return spending;}).reduce(function(sum,spending){return sum+spending.amountUsed;},0)]})]},household.id);})}),/*#__PURE__*/_jsx(\"div\",{className:style.button,children:/*#__PURE__*/_jsx(Link,{to:\"/addhousehold\",children:\"\\u3042\\u305F\\u3089\\u3057\\u3044\\u5BB6\\u8A08\\u7C3F\\u3092\\u3064\\u304F\\u308B\"})})]});};export default HouseHold;","map":{"version":3,"sources":["/Users/taiki/Desktop/household/frontend/src/components/Household/HouseHold.tsx"],"names":["React","useContext","useState","useEffect","AuthContext","Link","format","addMonths","subMonths","useWindowDimensions","getAllHousehold","getMonthSpendingTotal","style","HouseholdBook","HouseHold","initialHousehold","id","name","amountPlanned","userId","createdAt","Date","updatedAt","currentUser","households","setHouseholds","spendings","setSpendings","allSpendingTotal","setAllSpendingTotal","allAmountPlanned","setAllAmountPlanned","targetDate","setTargetDate","openPcHouseholdModal","setOpenPcHouseholdModal","balance","width","handleChangePcModal","handleGetAllHousehold","res","status","data","console","log","handleGetAllSpendingTotal","params","total","allSpending","household","month","balance_amount_blue","balance_amount_red","amount_total","monthMove","current","householdMap","map","householdBook","householdName","amount","filter","spending","householdId","reduce","sum","amountUsed","button"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect } from 'react'\nimport { AuthContext } from '../../App';\nimport { Link } from 'react-router-dom';\n\n// calendar\nimport format from 'date-fns/format';\nimport addMonths from 'date-fns/addMonths';\nimport subMonths from 'date-fns/subMonths';\n\n//component\nimport AddHousehold from './AddHouseHold/AddHousehold';\n\n// function\nimport { useWindowDimensions } from '../../function/window';\n\n// api\nimport { getAllHousehold, getMonthSpendingTotal } from '../../api/household';\n\n// css\nimport style from './HouseHold.module.scss';\n\n// interface\nimport { GetSpending } from '../../interface';\n\n// image\nimport HouseholdBook from '../../image/householdBook.png';\n\ninterface Household {\n  id: number;\n  name: string;\n  amountPlanned: number;\n  userId: number;\n  createdAt: Date;\n  updatedAt: Date;\n};\n\nconst HouseHold: React.FC = () => {\n  const initialHousehold = {\n    id: 1,\n    name: \"\",\n    amountPlanned: 1,\n    userId: 0,\n    createdAt: new Date(),\n    updatedAt: new Date()\n  };\n\n  const { currentUser } = useContext(AuthContext);\n  const [households, setHouseholds] = useState([initialHousehold]);\n  const [spendings, setSpendings] = useState([]);\n  const [allSpendingTotal, setAllSpendingTotal] = useState(0);\n  const [allAmountPlanned, setAllAmountPlanned] = useState(0);\n  const [targetDate, setTargetDate] = useState(new Date());\n  const [openPcHouseholdModal, setOpenPcHouseholdModal] = useState(false);\n\n  const balance = allAmountPlanned - allSpendingTotal;\n  const width = useWindowDimensions();\n\n  const handleChangePcModal = () => {\n    setOpenPcHouseholdModal(true);\n  };\n\n  // 家計簿一覧の取得\n  const handleGetAllHousehold = async () => {\n    if(!currentUser) return;\n    try {\n      const res = await getAllHousehold(currentUser.id);\n      if(res?.status === 200) {\n        setHouseholds(res.data);\n      };\n    } catch (err: any) {\n      console.log(err);\n    }\n  };\n\n  // 全家計簿の月別利用合計の取得\n  const handleGetAllSpendingTotal = async () => {\n    const params = { \n      targetDate: targetDate,\n    }\n\n    if (!currentUser)return;\n    try {\n      const res = await getMonthSpendingTotal(currentUser.id, params);\n      setAllSpendingTotal(res?.data.total);\n      setAllAmountPlanned(res?.data.allAmountPlanned)\n      setSpendings(res?.data.allSpending);\n    } catch (err: any) {\n      console.log('月別全合計', err);\n    };\n  };\n\n\n   useEffect(() => {\n      handleGetAllHousehold();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    handleGetAllSpendingTotal();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [targetDate])\n\n  return (\n    <div className={style.household}>\n      <h2>{currentUser?.name}</h2>\n      <div className={style.month}>\n        <h3>{format(targetDate, 'M月')}:  <span className={balance >= 0 ? style.balance_amount_blue : style.balance_amount_red }>¥{balance}</span></h3>\n        <h4 className={style.amount_total}>利用額: <span>-{allSpendingTotal}</span></h4>\n      </div>\n      <div className={style.monthMove}>\n        <span \n          onClick={() => setTargetDate(current => subMonths(current, 1))}\n        >\n          &lsaquo; 前の月\n        </span>\n        <span\n          onClick={() => setTargetDate(new Date())}\n        >\n          今月\n        </span>\n        <span \n          onClick={() => setTargetDate(current => addMonths(current, 1))}\n        >\n          次の月 &rsaquo;\n        </span>\n      </div>\n      <div className={style.householdMap}>\n        { households &&\n            households.map((household: Household) => {\n              return (\n                <div key={household.id} className={style.householdBook}>\n                  <div className={style.householdName}>\n                    {household.name}\n                  </div>\n                  <div>\n                    <Link to={`/${household.id}/spendings`}>\n                      <img src={HouseholdBook} alt='household book' />\n                    </Link>\n                  </div>\n                  <p className={style.amount}>\n                    ¥\n                      {spendings &&\n                        // eslint-disable-next-line array-callback-return\n                        spendings.filter((spending: GetSpending) => {\n                          if (household.id === spending.householdId) return spending;\n                        })\n                        .reduce((sum, spending: GetSpending) => sum + spending.amountUsed, 0)\n                      }\n                  </p>\n                </div>\n              )\n            })\n        }\n      </div>\n      <div className={style.button}>\n        <Link to='/addhousehold'>\n              あたらしい家計簿をつくる\n        </Link>\n      </div>\n    </div>\n  )\n}\n\nexport default HouseHold"]},"metadata":{},"sourceType":"module"}